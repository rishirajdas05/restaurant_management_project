{% extends "base.html" %}
{% load static %}

{% block title %}Home - My Restaurant{% endblock %}

{% block content %}
  <h1>Welcome to My Restaurant üç¥</h1>
  <p>Explore our delicious menu below:</p>

  <!-- Menu Section -->
  <section id="menu">
      <h2>Menu</h2>

      <!-- Loading and error messages -->
      <p id="menu-loading">Loading menu‚Ä¶</p>
      <p id="menu-error" style="display:none; color:red;">Failed to load menu. Please try again later.</p>

      <!-- List of menu items -->
      <ul id="menu-list" style="list-style:none; padding-left:0;">
          <!-- Items will be injected here -->
      </ul>
  </section>

  <!-- API URL passed from view -->
  <div id="menu-config" data-api-url="{{ menu_api_url }}"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const configEl = document.getElementById("menu-config");
        const apiUrl = configEl.dataset.apiUrl;
        const listEl = document.getElementById("menu-list");
        const loadingEl = document.getElementById("menu-loading");
        const errorEl = document.getElementById("menu-error");

        fetch(apiUrl)
          .then(res => {
              if (!res.ok) throw new Error("Network error");
              return res.json();
          })
          .then(data => {
              loadingEl.style.display = "none";
              if (data.length === 0) {
                  listEl.innerHTML = "<li>No menu items available.</li>";
                  return;
              }
              listEl.innerHTML = data.map(item => `
                  <li style="margin:10px 0; padding:10px; border:1px solid #ddd; border-radius:6px;">
                      <strong>${item.name}</strong> ‚Äî ‚Çπ${item.price}
                  </li>
              `).join("");
          })
          .catch(err => {
              console.error(err);
              loadingEl.style.display = "none";
              errorEl.style.display = "block";
          });
    });
  </script>
{% endblock %}
